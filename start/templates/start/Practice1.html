{% extends "otree/Page.html" %}
{% load otree static %}

{% block content %}

<!-- Pass Django -> JS -->
<script>
    window.page_settings       = {{ settings|json }};
    window.interpreter_choices = {{ session.vars.interpreter_choices|json }};
    window.interpreter_title   = {{ session.vars.interpreter_title|json }};
</script>

<div id="app">
    <h1>[[ title ]]</h1>
    <div v-html="main_text"></div>

    <div class="text-center my-3">
        <img :src="image_path" :alt="title"
             style="max-width: 600px; width: 100%; height: auto;">
    </div>

    <form id="practice-form" @submit.prevent="validate">
        <table class="table">
            <thead>
                <tr>
                    <th>[[ interpreter_title ]]</th>
                    <th>Yes</th>
                    <th>No</th>
                </tr>
            </thead>

            <tbody>
                <tr v-for="(row, idx) in rows" :key="idx">
                    <td>[[ row.name ]]</td>
                    <td><input type="radio" v-model="row.choice" :value="true"></td>
                    <td><input type="radio" v-model="row.choice" :value="false"></td>
                </tr>
            </tbody>
        </table>

        <p v-if="error" class="alert alert-danger">
            Please check your answers.
        </p>

        <button type="button"
                class="btn btn-primary"
                :disabled="!allChosen"
                @click="validate">
            Next
        </button>
    </form>
</div>

<!-- Vue 3 -->
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

<script>
const app = Vue.createApp({
    data() {
        const S  = window.page_settings || {};
        const IC = window.interpreter_choices || [];

        return {
            title: S.title || "Practice",
            main_text: S.main_text || "",
            image_path: S.full_image_path || "",
            interpreter_title: window.interpreter_title || "Interpretation",

            rows: IC.map(label => ({
                name: label,
                choice: null
            })),

            correct: (S.right_answer || []).map(x => Boolean(parseInt(x))),
            error: false
        };
    },

    computed: {
        allChosen() {
            return this.rows.every(r => r.choice !== null);
        }
    },

    methods: {
        validate() {
            if (!this.allChosen) {
                this.error = true;
                return;
            }

            if (this.correct.length !== this.rows.length) {
                this.error = true;
                return;
            }

            const ok = this.rows.every((r, i) => r.choice === this.correct[i]);
            this.error = !ok;

            if (ok) document.getElementById("practice-form").submit();
        }
    }
});

app.config.compilerOptions.delimiters = ["[[", "]]"];
app.mo
