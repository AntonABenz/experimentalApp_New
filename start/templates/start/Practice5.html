{% extends "otree/Page.html" %}
{% load otree static %}

{% block content %}

<style>
    /* Hides Vue content until loaded */
    [v-cloak] { display: none; }

    /* Styles for the Vocabulary Box Container */
    .vocab-container {
        border: 1px solid #dee2e6;
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        max-width: 700px;
        margin: 2rem auto;
        text-align: center;
    }

    /* Style for individual word badges */
    .vocab-word {
        display: inline-block;
        background-color: #ffffff;
        border: 1px solid #ced4da;
        color: #495057;
        padding: 6px 12px;
        margin: 4px;
        border-radius: 4px;
        font-size: 1rem;
        box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    
    .vocab-section-title {
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: #6c757d;
        margin-bottom: 10px;
        margin-top: 10px;
        font-weight: bold;
    }
</style>

<script>
    window.page_settings = {{ settings|json }};
</script>

<div id="app" v-cloak>
    
    <h1 class="mb-4">[[ title ]]</h1>
    <div class="lead mb-4" v-html="main_text"></div>

    <div class="text-center my-4">
        <img :src="image_path"
             :alt="title"
             class="img-fluid"
             style="box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-radius: 4px; max-height: 500px; max-width: 100%;">
    </div>

    <div class="vocab-container" v-if="hasVocabulary">
        <h5 class="mb-3 text-primary">Available Vocabulary</h5>
        
        <div v-if="vocab1.length > 0">
            <div class="d-flex flex-wrap justify-content-center mb-3">
                <span v-for="(word, idx) in vocab1" :key="'v1-'+idx" class="vocab-word">
                    [[ word ]]
                </span>
            </div>
        </div>

        <hr v-if="vocab1.length > 0 && vocab2.length > 0" style="margin: 10px 0;">

        <div v-if="vocab2.length > 0">
            <div class="d-flex flex-wrap justify-content-center">
                <span v-for="(word, idx) in vocab2" :key="'v2-'+idx" class="vocab-word">
                    [[ word ]]
                </span>
            </div>
        </div>
    </div>

    <div class="text-center mt-5">
        <button type="button" 
                class="btn btn-primary btn-lg" 
                @click="submitForm">
            Next
        </button>
    </div>

</div>

<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
const app = Vue.createApp({
    data() {
        const s = window.page_settings || {};

        // Helper to parse "word1; word2; word3" strings into arrays
        const parseList = (str) => {
            if (!str) return [];
            // If it's already an array, return it. If string, split by semicolon
            if (Array.isArray(str)) return str; 
            return String(str).split(';').map(w => w.trim()).filter(w => w.length > 0);
        };

        return {
            title: s.title || 'Practice 5',
            main_text: s.main_text || 'Please review the image. In the actual task, you can only use the vocabulary below.',
            image_path: s.full_image_path || '',

            // Pull vocabulary from settings
            vocab1: parseList(s.allowed_values_1),
            vocab2: parseList(s.allowed_values_2)
        };
    },

    computed: {
        hasVocabulary() {
            return this.vocab1.length > 0 || this.vocab2.length > 0;
        }
    },

    methods: {
        submitForm() {
            const outerForm = document.querySelector('form');
            if (outerForm) outerForm.submit();
        }
    }
});

app.config.compilerOptions.delimiters = ['[[', ']]'];
app.mount('#app');
</script>

{% endblock %}
